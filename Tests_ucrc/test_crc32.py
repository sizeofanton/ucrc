from ucrc import crc32
from ucrc import crc32_fast
from ucrc import crc32_gen_table
import pytest


def test_crc32_type_error():
    with pytest.raises(TypeError):
        crc32("Not a bytes")
    with pytest.raises(TypeError):
        crc32(bytes([0xFF,0x22,0x33,0xFA,0xFF,0x00]),in_ref="Yes")


def test_crc32_results():
    assert crc32(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00])) == 0x969E0A29
    assert crc32(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00]), poly=0x99FA99FA) == 0x7B6BD1B6
    assert crc32(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00]), in_ref=True) == 0x89BCDF3B
    assert crc32(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00]), out_ref=True) == 0x94507969
    assert crc32(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00]), in_ref=True, out_ref=True) == 0xDCFB3D91


def test_crc32_table_results():
    table = crc32_gen_table()
    assert crc32_fast(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00]), table) == 0x969E0A29
    assert crc32_fast(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00]), table, in_ref=True) == 0x89BCDF3B
    assert crc32_fast(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00]), table, out_ref=True) == 0x94507969
    assert crc32_fast(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00]), table, in_ref=True, out_ref=True) == 0xDCFB3D91
    table = crc32_gen_table(0x99FA99FA)
    assert crc32_fast(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00]), table) == 0x7B6BD1B6

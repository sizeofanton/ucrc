from ucrc import crc16
from ucrc import crc16_fast
from ucrc import crc16_gen_table
import pytest


def test_crc16_type_error():
    with pytest.raises(TypeError):
        crc16("Not a bytes")
    with pytest.raises(TypeError):
        crc16(bytes([0xFF,0x22,0x33,0xFA,0xFF,0x00]),in_ref="Yes")


def test_crc16_results():
    assert crc16(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00])) == 0x4644
    assert crc16(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00]), poly=0x99FA) == 0x9362
    assert crc16(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00]), in_ref=True) == 0x3203
    assert crc16(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00]), out_ref=True) == 0x2262
    assert crc16(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00]), in_ref=True, out_ref=True) == 0xC04C


def test_crc16_table_results():
    table = crc16_gen_table()
    assert crc16_fast(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00]),table) == 0x4644
    table = crc16_gen_table(0x99FA)
    assert crc16_fast(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00]), table) == 0x9362
    table = crc16_gen_table()
    assert crc16_fast(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00]), table, in_ref=True) == 0x3203
    assert crc16_fast(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00]), table, out_ref=True) == 0x2262
    assert crc16_fast(bytes([0xFF, 0xFE, 0xFA, 0xF0, 0xFF, 0x00]), table, in_ref=True, out_ref=True) == 0xC04C